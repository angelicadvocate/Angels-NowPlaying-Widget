<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EditorV2-Frame4</title>
  <link rel="stylesheet" href="04-EditorV2-F4-Styles.css" />
</head>
<body>
  <main id="site">
    <section id="controls">
      <label for="artist_name" class="info">Artist Name Size</label>
      <input type="range" min="8" max="45" value="20" class="slider" id="artist_name"> 

      <label for="track_title" class="info">Track Title Size</label>
      <input type="range" min="8" max="53" value="32" class="slider" id="track_title">  

      <label for="spacing" class="info">Spacing Horizontal</label>
      <input type="range" min="-12" max="20" value="8" class="slider" id="spacing">  

      <label class="info" for="imageSize">Album Art Size</label>
      <input type="range" min="40" max="300" value="110" class="slider" id="imageSize">

      <label for="contentPadding" class="info">Text Left Padding</label>
      <input type="range" min="0" max="200" value="20" class="slider" id="contentPadding">

      <label for="imagePadding" class="info">Image Left Padding</label>
      <input type="range" min="-150" max="50" value="25" class="slider" id="imagePadding">

      <label for="color" class="info">Artist Name Color</label>
      <input type="range" min="0" max="355" value="355" class="slider" id="color">
        <div id="colorDisplay" class="info" style="margin-top: 5px;">
          Color Code: <code id="colorCode">#ff66aa</code>
        </div>

    </section>

<section id="sample">
  <div id="background">
    <div id="image-wrapper">
  <img id="image" src="../static_assets/SampleAlbum.png" alt="Album Art" />
    </div>
    <div id="content">
      <div id="text-box">
        <p id="artist">Sample Artist</p>
        <p id="song">Sample Song Title</p>
      </div>
    </div>
  </div>
</section>

    
    <div style="text-align: center; margin-top: 20px;">
      <button id="save">Save</button>
    </div>
  </main>

  <script>
    const artistSize = document.getElementById("artist_name");
    const songSize = document.getElementById("track_title");
    const spacing = document.getElementById("spacing");
    const color = document.getElementById("color");
    const artistEl = document.getElementById("artist");
    const songEl = document.getElementById("song");
    const image = document.getElementById('image');
    const imageSizeSlider = document.getElementById('imageSize');
    const contentPaddingSlider = document.getElementById('contentPadding');
    const imagePaddingSlider = document.getElementById('imagePadding');

    let imagePaddingValue = imagePaddingSlider.value;    
    let contentPaddingValue = contentPaddingSlider.value;
    let imageSizeValue = imageSizeSlider.value;
    let artistSizeValue = artistSize.value;
    let songSizeValue = songSize.value;
    let spacingValue = spacing.value;
    let colorValue = color.value;

function applyPreview() {
  artistEl.style.fontSize = artistSizeValue + "px";
  songEl.style.fontSize = songSizeValue + "px";
  artistEl.style.marginBottom = spacingValue + "px";
  artistEl.style.color = `hsl(${colorValue}, 100%, 68%)`;
  
    // Convert HSL to hex for OBS
      function hslToHex(h, s, l) {
        s /= 100;
        l /= 100;
        const k = n => (n + h / 30) % 12;
        const a = s * Math.min(l, 1 - l);
        const f = n =>
          Math.round(255 * (l - a * Math.max(-1, Math.min(k(n) - 3, Math.min(9 - k(n), 1)))));
        return "#" + [f(0), f(8), f(4)].map(x => x.toString(16).padStart(2, '0')).join('');
      }
      const hex = hslToHex(colorValue, 100, 68);
      document.getElementById("colorCode").textContent = hex;

  image.style.width = imageSizeValue + "px";
  image.style.height = imageSizeValue + "px";
  const content = document.getElementById('content');
  content.style.padding = `0 20px 0 ${contentPaddingValue}px`;
  const imageWrapper = document.getElementById('image-wrapper');
  imageWrapper.style.marginLeft = imagePaddingValue + "px";
}


    function generateCSS() {
      // emit a CSS file matching css/04-NowPlaying-F4-Styles.css
      return `
/* F4 Now-Playing frame styles (generated by editor) */
:root{
  --f4-width: ${1800};
  --f4-height: ${150};
  --highlight: hsl(${colorValue}, 82%, 58%);
  --font-main: "proxima-nova", sans-serif;
  --scroll-extra: 40;
  --scroll-start-offset: 30;
  --visualizer-opacity: 0.7;
  --progress-width-px: ${450}px;
  --progress-left-px: ${0}px;
  --text-left-px: ${0}px;
  --text-start-offset: ${0}px;
}

html,body{ margin:0; padding:0; height:100%; font-family:var(--font-main); background:transparent; }

#background{ position:relative; width:var(--f4-width); min-width:var(--f4-width); max-width:var(--f4-width); height:var(--f4-height); background-image: url('../static_assets/Frame4.png'); background-repeat: no-repeat; background-position: center; background-size: contain; box-sizing:border-box; display:flex; align-items:center; justify-content:center; padding:0; overflow:visible; }

#visualizer{ position:absolute; right:-120px; top:0px; width:1430px; height:150px; object-fit:cover; opacity:var(--visualizer-opacity); pointer-events:none; z-index:2; }

#progress-container{ position:relative; width:var(--progress-width-px); margin-left:var(--progress-left-px); height:8px; margin-top:8px; background:rgba(255,255,255,0.06); border-radius:4px; overflow:hidden; z-index:45; }

#progress-bar{ width:0%; height:100%; background:linear-gradient(90deg,var(--highlight), #8fe); transition: width 0.1s linear; }

#image{ width:120px; height:120px; object-fit:cover; border-radius:4px; display:block; margin-left:20px; z-index:40; }

#content{ flex:1; overflow:hidden; padding:0 20px 0 30px; box-sizing:border-box; display:flex; flex-direction:row; align-items:center; z-index:40; }

#text-box{ display:flex; flex-direction:column; justify-content:center; min-width:0; margin-left: -10px; flex-grow:1; overflow:hidden; text-align:left; }

.text-clip{ width:var(--progress-width-px); margin-left:var(--text-left-px); overflow:hidden; white-space:nowrap; }
.text-item{ display:inline-block; white-space:nowrap; }
.text-row{ display:block; overflow:visible; }
.text-inner{ display:inline-block; white-space:nowrap; }

#artist,#song{ margin:0; display:inline-block; }
.text-row{ display:block; overflow:visible; margin-bottom:4px; line-height:1; }
.text-inner{ display:block; white-space:nowrap; }

#artist,#song{ margin:0; display:block; }

#artist{ text-transform:uppercase; font-weight:600; font-size:${artistSizeValue * scale}px; margin:0 0 ${5 * scale}px 0; color:var(--highlight); }

#song{ font-weight:bold; font-size:${songSizeValue * scale}px; margin:0; color:white; }

/* ensure the visual layers stack correctly in OBS */
#background > *{pointer-events:none}

@media (max-width:1200px){ #visualizer{display:none} }

      `.trim();
    }

    function downloadCSS(filename, content) {
      const blob = new Blob([content], {type: "text/css"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
    }

[artistSize, songSize, spacing, color, imageSizeSlider, contentPaddingSlider, imagePaddingSlider].forEach((slider) => {
  slider.addEventListener("input", (e) => {
    if (e.target === artistSize) artistSizeValue = e.target.value;
    if (e.target === songSize) songSizeValue = e.target.value;
    if (e.target === spacing) spacingValue = e.target.value;
    if (e.target === color) colorValue = e.target.value;
    if (e.target === imageSizeSlider) imageSizeValue = e.target.value;
    if (e.target === contentPaddingSlider) contentPaddingValue = e.target.value;
    if (e.target === imagePaddingSlider) imagePaddingValue = e.target.value;
    applyPreview();
  });
});

    document.getElementById("save").addEventListener("click", () => {
      // Update preview for visual feedback
      applyPreview();
      // Trigger download of generated CSS
      downloadCSS("04-NowPlaying-F4-Styles.css", generateCSS());
    });

    applyPreview();

  </script>

      <button id="back_button" onclick="history.back()">Back to Editor Dashboard</button>
      
</body>
</html>
